# System Verification & Smoke Test Checklist
Generated by: QA Agent
Date: 2025-12-31

## 1. Logic Audit Results
- **Decimal Precision**: ✅ PASSED. Scoring uses exact division (`revenue / 100`), ensuring accumulation of fractional points (pennies).
- **Payout Safety**: ✅ PASSED. `markRepAsPaid` strictly queries for `status != 'paid'`, preventing double-payments.
- **Modal Validation**: ✅ PASSED. "Mark as Sold" submit button is disabled until both Revenue and Deal Type are set. Logic correctly initializes Type to empty.
- **Admin Layout**: ✅ PASSED. Dashboard structure (Quarterly/Bi-Weekly Cards) is intact.
- **Quarterly Reset**: ✅ PASSED. `calculateRepScore` explicitly calls `isInCurrentQuarter` before adding ANY points.

---

## 2. "Smoke Test" Script (Manual QA)

Run these 5 tests in order to certify the system for deployment.

### Test 1: The "Time Monitor" (Quarterly Reset)
**Action**:
1. Manually create a Lead in Firestore (or via basic form if avail) with a `date` set to **4 months ago**.
2. Refresh Leaderboard.
**Expectation**:
- The Rep's "Total Score" for this Season should **NOT** increase.
- The Lead **SHOULD** appear in "Lifetime Revenue" or historical stats (if visible), but contribute **0 Points** to the current season.

### Test 2: The "Fresh Kill" (Current Scoring)
**Action**:
1. Create a NEW Lead dated **Today**.
2. Mark it as "Sold" -> "New Customer" -> Revenue **$150.00**.
**Expectation**:
- **Score Delta**: 
    - +1.0 (Activity)
    - +5.0 (New Customer Bonus)
    - +1.5 (Revenue Bonus: 150 / 100)
    - **Total Increase**: +7.5 Points.
- Verify Leaderboard reflects exactly this increase.

### Test 3: The "Double Dip" Prevention (Validations)
**Action**:
1. Open "Mark as Sold" modal.
2. Enter Revenue: `500`.
3. Do **NOT** select a "Deal Type".
4. Try to click "Save Sale".
**Expectation**:
- Button should be **Disabled** (Grayed out) or show an error.
- No Sale should be created.

### Test 4: The "Decimals Check"
**Action**:
1. Mark a Lead "Sold" with revenue **$1,234.56**.
**Expectation**:
- **Revenue Points**: 1234.56 / 100 = `12.3456`.
- Total Score should increase by exactly `12.3456` (plus bonuses).
- Leaderboard "Score" column should display `X.35` (Rounded to 2 decimals for display, but logic holds precision). 

### Test 5: The "Payday" (Admin Payouts)
**Action**:
1. Log in as Admin.
2. Go to Payroll Tab > Sales Commissions.
3. Click "Mark Payout Complete" for a Rep.
4. Refresh the page.
**Expectation**:
- The Rep's specific "Total Due" should drop to **$0.00**.
- The items marked paid should **disappear** from the list.
- They should not reappear upon reload.

---

## 3. Critical Edge Case Note
**Found**: Leaderboard relies on `getLeads()`. 
- If a Sale is created for a Dispensary that originated as a **Shift** (no underlying Lead document), the `updateLead` call in `MyDispensaries` handles the logic gracefully, but `calculateRepScore` might miss it if no Lead doc exists.
- **Recommendation**: Ensure every "Sales" active dispensary has a corresponding "Lead" document, or update Leaderboard to fetch Sales directly. For now, the system assumes "Green Truth" model where everything starts as a Lead.
